<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- fonts -->
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Open+Sans:wdth,wght@75,700&family=Roboto+Mono:ital,wght@0,400;0,700;1,400&family=Spectral:ital,wght@0,400;0,700;1,400&display=swap');
  </style>

  <title>Tobin Yehle | Automatic Table of Contents in Jekyll</title>
  <meta name="description" content="Edit from 2020:">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://tobin.yehle.us/articles/table-of-contents">
  <link rel="alternate" type="application/rss+xml" title="Tobin Yehle" href="http://tobin.yehle.us/feed.xml">

  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?">

  
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <span class="header-title"><a class="site-title" href="/">
  <span class="site-title-brace">{</span>
  Tobin Yehle
  <span class="site-title-brace">}</span>
</a></span>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        

        
          
        
          
        
          
        
          
        
          
            
              <a class="page-link" href="/">About</a>
            
          
        
          
            
              <a class="page-link" href="/articles/">Articles</a>
            
          
        
          
            
              <a class="page-link" href="/projects">Projects</a>
            
          
        
          
            
              <a class="page-link" href="/pottery">Pottery</a>
            
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="page-header">
    <h1 class="post-title" itemprop="name headline">Automatic Table of Contents in Jekyll</h1>
    <p class="post-meta"><time datetime="2017-02-26T00:00:00+00:00" itemprop="datePublished">2017-02-26</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
  	<hr>
    <h1 id="edit-from-2020">Edit from 2020:</h1>

<p>Kramdown now makes this easy! Checkout <a href="https://about.gitlab.com/blog/2016/07/19/markdown-kramdown-tips-and-tricks/#table-of-contents-toc">these gitlab docs</a> for a modern way to do this.</p>

<hr />

<p>I recently wrote a <a href="/articles/lambda-compiler">very long post</a> and I wanted a table of contents to appear at the top.</p>

<p>I also came up with a good test for the length of a post; if a table of contents would be helpful, its too long.</p>

<p>All the code for this project is <a href="https://github.com/tyehle/toc-generation">on github</a>. There is also <a href="http://tobin.yehle.io/toc-generation/">an example page</a>.</p>

<hr />

<h2 id="results">Results</h2>

<p>Kramdown adds an <code class="language-plaintext highlighter-rouge">id</code> attribute to all headers automatically. The table of contents contains links to these headers.</p>

<p>The most basic interface is:</p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% include toc.html %}
</code></pre></div></div>

<p>The user should also be able to specify which tags to link to and to manually ignore specific tags. The include takes arguments to achieve this.</p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% include toc.html tags="H2,H3" ignore="#sections" %}
</code></pre></div></div>

<hr />

<h2 id="details">Details</h2>

<p>The html include loads jQuery from Googleâ€™s CDN if it can otherwise it falls back to the local copy. I do this because the CDN is probably faster to load, but if it fails, then the page will still load. I like this because one of the big advantages of Jekyll is offline development. I shamelessly stole this idea from <a href="http://stackoverflow.com/a/1014251">this question</a>.</p>

<p>The html include file uses liquid tags translate the arguments into JavaScript.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">"_toc"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.slim.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">window</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;script src="{{ "/js/jquery-3.1.1.slim.min.js" | prepend: site.baseurl }}"&gt;&lt;</span><span class="se">\</span><span class="s1">/script&gt;</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="nt">&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">'{{ "/js/toc.js" | prepend: site.baseurl }}'</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="kd">let</span> <span class="nx">tags</span> <span class="o">=</span> <span class="p">{</span><span class="o">%</span><span class="k">if</span> <span class="nx">include</span><span class="p">.</span><span class="nx">tags</span><span class="o">%</span><span class="p">}</span><span class="dl">"</span><span class="s2">{{include.tags}}</span><span class="dl">"</span><span class="p">{</span><span class="o">%</span><span class="k">else</span><span class="o">%</span><span class="p">}</span><span class="dl">"</span><span class="s2">H1,H2,H3,H4</span><span class="dl">"</span><span class="p">{</span><span class="o">%</span><span class="nx">endif</span><span class="o">%</span><span class="p">};</span>
    <span class="kd">let</span> <span class="nx">ignore</span> <span class="o">=</span> <span class="p">{</span><span class="o">%</span><span class="k">if</span> <span class="nx">include</span><span class="p">.</span><span class="nx">ignore</span><span class="o">%</span><span class="p">}</span><span class="dl">"</span><span class="s2">{{include.ignore}}</span><span class="dl">"</span><span class="p">{</span><span class="o">%</span><span class="k">else</span><span class="o">%</span><span class="p">}</span><span class="dl">''</span><span class="p">{</span><span class="o">%</span><span class="nx">endif</span><span class="o">%</span><span class="p">};</span>
    <span class="nf">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nf">ready</span><span class="p">(</span><span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
      <span class="nf">toc</span><span class="p">(</span><span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#_toc</span><span class="dl">"</span><span class="p">),</span> <span class="nx">tags</span><span class="p">,</span> <span class="nx">ignore</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre></div></div>

<p>The id of the <code class="language-plaintext highlighter-rouge">&lt;ul&gt;</code> to put the table in is <code class="language-plaintext highlighter-rouge">_toc</code> because, as far as I can tell, Kramdown will not generate that id automatically. If the document contained a header called ToC, and it appeared before the include call, then the entire table would be inserted into the header tag. Not pretty. This is still technically possible if someone manually set an id to <code class="language-plaintext highlighter-rouge">_toc</code> anywhere before the include call.</p>

<h3 id="javascript">JavaScript</h3>

<p>The first step is to get the headers and what level those headers should be displayed at. The order of the input tags is used to determine the level.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">getHeaders</span><span class="p">(</span><span class="nx">tagNames</span><span class="p">,</span> <span class="nx">ignore</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">tags</span> <span class="o">=</span> <span class="nx">tagNames</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="dl">"</span><span class="s2">,</span><span class="dl">"</span><span class="p">);</span>
  <span class="k">return</span> <span class="nf">$</span><span class="p">(</span><span class="nx">tagNames</span><span class="p">.</span><span class="nf">toString</span><span class="p">()).</span><span class="nf">filter</span><span class="p">(</span><span class="dl">"</span><span class="s2">[id]</span><span class="dl">"</span><span class="p">).</span><span class="nf">not</span><span class="p">(</span><span class="nx">ignore</span><span class="p">).</span><span class="nf">map</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">level</span><span class="p">:</span> <span class="nx">tags</span><span class="p">.</span><span class="nf">indexOf</span><span class="p">(</span><span class="nf">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nf">prop</span><span class="p">(</span><span class="dl">"</span><span class="s2">tagName</span><span class="dl">"</span><span class="p">)),</span>
      <span class="na">link</span><span class="p">:</span> <span class="dl">"</span><span class="s2">#</span><span class="dl">"</span> <span class="o">+</span> <span class="nf">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nf">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">),</span>
      <span class="na">text</span><span class="p">:</span> <span class="nf">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nf">text</span><span class="p">()</span>
    <span class="p">};</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Next I used a linked list of buffers to build a nested array header information.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">nestHeaders</span><span class="p">(</span><span class="nx">headers</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">base</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="kd">let</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="p">{</span><span class="na">level</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="na">list</span><span class="p">:</span> <span class="nx">base</span><span class="p">,</span> <span class="na">prev</span><span class="p">:</span> <span class="kc">undefined</span><span class="p">};</span>
  <span class="nx">headers</span><span class="p">.</span><span class="nf">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="nx">header</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">header</span><span class="p">.</span><span class="nx">level</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">while</span><span class="p">(</span><span class="nx">header</span><span class="p">.</span><span class="nx">level</span> <span class="o">&gt;</span> <span class="nx">buffer</span><span class="p">.</span><span class="nx">level</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">newBuffer</span> <span class="o">=</span> <span class="p">{</span><span class="na">level</span><span class="p">:</span> <span class="nx">buffer</span><span class="p">.</span><span class="nx">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="na">list</span><span class="p">:</span> <span class="p">[],</span> <span class="na">prev</span><span class="p">:</span> <span class="nx">buffer</span><span class="p">};</span>
        <span class="nx">buffer</span> <span class="o">=</span> <span class="nx">newBuffer</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">while</span><span class="p">(</span><span class="nx">header</span><span class="p">.</span><span class="nx">level</span> <span class="o">&lt;</span> <span class="nx">buffer</span><span class="p">.</span><span class="nx">level</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">buffer</span><span class="p">.</span><span class="nx">prev</span><span class="p">.</span><span class="nx">list</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="nx">buffer</span><span class="p">.</span><span class="nx">list</span><span class="p">);</span>
        <span class="nx">buffer</span> <span class="o">=</span> <span class="nx">buffer</span><span class="p">.</span><span class="nx">prev</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="nx">buffer</span><span class="p">.</span><span class="nx">list</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="nx">header</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="k">while</span><span class="p">(</span><span class="nx">buffer</span><span class="p">.</span><span class="nx">prev</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">buffer</span><span class="p">.</span><span class="nx">prev</span><span class="p">.</span><span class="nx">list</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="nx">buffer</span><span class="p">.</span><span class="nx">list</span><span class="p">);</span>
    <span class="nx">buffer</span> <span class="o">=</span> <span class="nx">buffer</span><span class="p">.</span><span class="nx">prev</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">base</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Using that nested array, I can recursively build the table off of a given base <code class="language-plaintext highlighter-rouge">ul</code> element. On each call it either generates an <code class="language-plaintext highlighter-rouge">li</code> element for that header or a <code class="language-plaintext highlighter-rouge">ul</code> element that is filled by a recursive call to <code class="language-plaintext highlighter-rouge">genToc</code>.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">genToc</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="nx">nestedHeaders</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">nestedHeaders</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">elem</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">elem</span> <span class="k">instanceof</span> <span class="nb">Array</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">ul</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">&lt;ul/&gt;</span><span class="dl">"</span><span class="p">);</span>
      <span class="nf">genToc</span><span class="p">(</span><span class="nx">ul</span><span class="p">,</span> <span class="nx">elem</span><span class="p">);</span>
      <span class="nx">base</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nx">ul</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">base</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">&lt;li/&gt;</span><span class="dl">"</span><span class="p">).</span><span class="nf">append</span><span class="p">(</span><span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">&lt;a/&gt;</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">href</span><span class="p">:</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">link</span><span class="p">,</span>
        <span class="na">text</span><span class="p">:</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">text</span>
      <span class="p">})));</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<p>These pieces are combined in the function <code class="language-plaintext highlighter-rouge">toc</code> which is called from the included html.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">toc</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="nx">tagNames</span><span class="p">,</span> <span class="nx">ignore</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">genToc</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="nf">nestHeaders</span><span class="p">(</span><span class="nf">getHeaders</span><span class="p">(</span><span class="nx">tagNames</span><span class="p">,</span> <span class="nx">ignore</span><span class="p">)));</span>
<span class="p">}</span>
</code></pre></div></div>

  </div>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-wrapper">
      <a class="site-title" href="/">
  <span class="site-title-brace">{</span>
  Tobin Yehle
  <span class="site-title-brace">}</span>
</a>
      <br>
      <a class="footer-contact" href="mailto:tobin.yehle@gmail.com">tobin.yehle@gmail.com</a>
      <br>
       <a class="username" href="https://github.com/tyehle">
	<span class="icon icon--github"><svg viewBox="0 0 16 16">
    <g>
        <path d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
    </g>
</svg>
</span>
	tyehle
</a>
 
    </div>

  </div>

</footer>


  </body>

</html>
